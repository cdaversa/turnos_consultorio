<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraci√≥n del Sistema</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- ‚úÖ Encabezado -->
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <h1>Configuraci√≥n del sistema</h1>
        <form action="{{ url_for('panel_admin') }}" method="get">
            <button type="submit" style="width:150px; padding:10px; font-size:18px; border-radius:5px;">
                Volver
            </button>
        </form>
    </div>

    <!-- ‚úÖ Claves -->
    <form method="post">
        <h2>Cambiar Clave de Administrador</h2>
        <input type="hidden" name="accion" value="cambiar_clave">
        <input type="password" name="nueva_clave" placeholder="Nueva clave" required>
        <button type="submit">Guardar Clave</button>
    </form>

    <form method="post">
        <h2>Cambiar Clave del Profesional</h2>
        <input type="hidden" name="accion" value="cambiar_clave_profesional">
        <input type="password" name="nueva_clave_profesional" placeholder="Nueva clave profesional" required>
        <button type="submit">Guardar Clave Profesional</button>
    </form>

    <hr>

    <!-- ‚úÖ Horarios -->
    <form method="post">
        <input type="hidden" name="accion" value="guardar_horarios">
        <h2>Configurar Horarios de Atenci√≥n</h2>

        {% for dia, horario in horarios.items() %}
        <div>
            <label>
                <input type="checkbox" name="activo_{{ dia }}" {% if horario|length < 3 or horario[2] %}checked{% endif %}>
                {{ dia.capitalize() }}
            </label>
            Desde: <input type="time" name="desde_{{ dia }}" value="{{ horario[0] }}">
            Hasta: <input type="time" name="hasta_{{ dia }}" value="{{ horario[1] }}">
        </div>
        {% endfor %}

        <hr>
        <h2>Intervalo de Turnos</h2>
        <label>Duraci√≥n (min):</label>
        <input type="number" name="intervalo_turnos" min="5" step="5" value="{{ intervalo }}" required>

        <hr>
        <button type="submit">Guardar Configuraci√≥n</button>
    </form>

    <hr>

    <!-- ‚úÖ SMTP -->
    <form method="post">
        <h2>Configuraci√≥n del Email SMTP</h2>
        <input type="hidden" name="accion" value="guardar_smtp">
        <label>Email SMTP:</label>
        <input type="email" name="smtp_email" value="{{ email_smtp }}" required>
        <label>Contrase√±a SMTP:</label>
        <input type="password" name="smtp_password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="{{ pass_smtp }}" required>
        <button type="submit">Guardar Configuraci√≥n SMTP</button>
    </form>

    <hr>

    <!-- ‚úÖ Feriados y Vacaciones con Calendario -->
    <form method="post">
        <h2>Feriados y Vacaciones</h2>
        <input type="hidden" name="accion" value="guardar_feriados">

        <h3>üìÖ Feriados</h3>
        <div id="feriados-container">
            {% for f in cfg.feriados %}
            <div class="feriado-item">
                <input type="date" name="feriados" value="{{ f }}">
                <button type="button" onclick="this.parentNode.remove()">‚ùå</button>
            </div>
            {% endfor %}
            {% if not cfg.feriados %}
            <div class="feriado-item">
                <input type="date" name="feriados">
            </div>
            {% endif %}
        </div>
        <button type="button" onclick="agregarFeriado()">‚ûï Agregar Feriado</button>

        <hr>

        <h3>üèñÔ∏è Vacaciones</h3>
        <div id="vacaciones-container">
            {% for v in cfg.get('vacaciones', []) %}
            <div class="vacacion-item">
                Inicio: <input type="date" name="vacaciones_inicio" value="{{ v.inicio }}">
                Fin: <input type="date" name="vacaciones_fin" value="{{ v.fin }}">
                <button type="button" onclick="this.parentNode.remove()">‚ùå</button>
            </div>
            {% endfor %}
            {% if not cfg.get('vacaciones') %}
            <div class="vacacion-item">
                Inicio: <input type="date" name="vacaciones_inicio">
                Fin: <input type="date" name="vacaciones_fin">
            </div>
            {% endif %}
        </div>
        <button type="button" onclick="agregarVacacion()">‚ûï Agregar Rango de Vacaciones</button>

        <hr>
        <button type="submit">Guardar Feriados y Vacaciones</button>
    </form> <!-- ‚úÖ Cierre correcto -->

    <hr>

    <!-- ‚úÖ Backup de la Base de Datos -->
    <h2>üíæ Backup de Base de Datos</h2>
    <p>Puedes descargar una copia de seguridad de todos los turnos guardados.</p>
    <a href="{{ url_for('backup_db') }}" 
       style="display:inline-block; padding:10px 20px; background:#007BFF; color:white; text-decoration:none; border-radius:5px;">
       üì• Descargar Backup
    </a>

    <script>
        function agregarFeriado() {
            const cont = document.getElementById("feriados-container");
            const div = document.createElement("div");
            div.classList.add("feriado-item");
            div.innerHTML = '<input type="date" name="feriados"> <button type="button" onclick="this.parentNode.remove()">‚ùå</button>';
            cont.appendChild(div);
        }

        function agregarVacacion() {
            const cont = document.getElementById("vacaciones-container");
            const div = document.createElement("div");
            div.classList.add("vacacion-item");
            div.innerHTML = 'Inicio: <input type="date" name="vacaciones_inicio"> Fin: <input type="date" name="vacaciones_fin"> <button type="button" onclick="this.parentNode.remove()">‚ùå</button>';
            cont.appendChild(div);
        }
    </script>

</body>
</html>
